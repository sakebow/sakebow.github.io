<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/fav/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/fav/favicon-16x16.png">
  <link rel="mask-icon" href="/images/fav/android-chrome-512x512.png" color="#222">
  <link rel="manifest" href="/images/fav/site.manifest.json">
  <meta name="msvalidate.01" content="baidu_verify_codeva-pRzwrRUz9m.html">

<link rel="stylesheet" href="/css/main.css">


  <script src='https://unpkg.com/mermaid@/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/pink/pace-theme-fill-left.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"sakebow.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前言在这篇文章中，我们学习了如何设置固定数量的动态背景图。接下来，我们在这篇文章的基础上继续增加功能，让动态背景图的数量也不是固定的、图像也不是固定的。">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo设置更多的动态背景图">
<meta property="og:url" content="http://sakebow.cn/2023/12/26/custom/background-dynamic-more/index.html">
<meta property="og:site_name" content="小小万事屋">
<meta property="og:description" content="前言在这篇文章中，我们学习了如何设置固定数量的动态背景图。接下来，我们在这篇文章的基础上继续增加功能，让动态背景图的数量也不是固定的、图像也不是固定的。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-12-26T00:58:45.000Z">
<meta property="article:modified_time" content="2024-02-02T07:50:24.393Z">
<meta property="article:author" content="sakebow">
<meta property="article:tag" content="css">
<meta property="article:tag" content="customize">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://sakebow.cn/2023/12/26/custom/background-dynamic-more/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://sakebow.cn/2023/12/26/custom/background-dynamic-more/","path":"2023/12/26/custom/background-dynamic-more/","title":"Hexo设置更多的动态背景图"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo设置更多的动态背景图 | 小小万事屋</title>
  







<script async src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">小小万事屋</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">一个似乎什么都想做的网站</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">16</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">8</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">16</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%9A%84%E8%83%8C%E6%99%AF%E5%9B%BE"><span class="nav-number">2.</span> <span class="nav-text">动态的背景图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%9B%BE%E5%BA%93"><span class="nav-number">3.</span> <span class="nav-text">更新图库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97"><span class="nav-number">4.</span> <span class="nav-text">时间计算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9src%E5%B1%9E%E6%80%A7%E8%BF%98%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%B0%86%E6%95%B4%E4%B8%AAimg%E6%A0%87%E7%AD%BE%E6%9B%BF%E6%8D%A2%E6%8E%89"><span class="nav-number">5.</span> <span class="nav-text">修改src属性还是直接将整个img标签替换掉</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.</span> <span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.1.</span> <span class="nav-text">保存位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E4%BB%A3%E7%A0%81"><span class="nav-number">6.2.</span> <span class="nav-text">增加代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B2%A1%E4%BB%80%E4%B9%88%E5%BF%85%E8%A6%81%E7%9A%84%E5%85%B6%E4%BB%96%E4%B8%9C%E8%A5%BF"><span class="nav-number">6.3.</span> <span class="nav-text">没什么必要的其他东西</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A4%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81"><span class="nav-number">6.4.</span> <span class="nav-text">两篇文章的全部代码</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="sakebow"
      src="/images/avatar/avatar.jpg"
          onmouseover = "this.src='/images/avatar/avatarc.png'"
          onmouseout = "this.src='/images/avatar/avatar.jpg'"
      >
  <p class="site-author-name" itemprop="name">sakebow</p>
  <div class="site-description" itemprop="description">一个似乎什么都想做的小站</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/sakebow" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sakebow" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yao-fan-de-ma-nong" title="ZhiHu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yao-fan-de-ma-nong" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sakebow.cn/2023/12/26/custom/background-dynamic-more/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.jpg">
      <meta itemprop="name" content="sakebow">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小小万事屋">
      <meta itemprop="description" content="一个似乎什么都想做的小站">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hexo设置更多的动态背景图 | 小小万事屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hexo设置更多的动态背景图
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-26 08:58:45" itemprop="dateCreated datePublished" datetime="2023-12-26T08:58:45+08:00">2023-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-02 15:50:24" itemprop="dateModified" datetime="2024-02-02T15:50:24+08:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/customize/" itemprop="url" rel="index"><span itemprop="name">customize</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在<a href="/2023/12/25/custom/background-dynamic/">这篇文章中</a>，我们学习了如何设置固定数量的动态背景图。接下来，我们在这篇文章的基础上继续增加功能，让动态背景图的数量也不是固定的、图像也不是固定的。</p>
<span id="more"></span>

<h1 id="动态的背景图"><a href="#动态的背景图" class="headerlink" title="动态的背景图"></a>动态的背景图</h1><p>在这里，我个人想从两个方面解释<strong>动态</strong>。</p>
<p>一方面是当前呈现的图片是不断轮转的，这是轮播图的基本定义。</p>
<p>另一方面就是呈现的图片并不是一开始就固定好的，而是在轮播的过程中不断更新的。</p>
<p>第一个方面我们已经实现了，在这里也就不多赘述。接下来我们思考如何实现第二个方面。</p>
<h1 id="更新图库"><a href="#更新图库" class="headerlink" title="更新图库"></a>更新图库</h1><p>为了响应速度更快，我个人倾向于将<code>loading</code>期间加载的内容固定下来，主要是为了能够让<code>loading</code>期间有一个基本的轮播图。</p>
<p>然后，在第一张图片轮转消失后，更新第一张图片。这样的话，显示的是第二张图片，而第一张图片已经在你看不见的地方更新掉了。当回到第一张图片的时候，我们发现轮转出来的是一张新的图片。</p>
<p>这样就能够分两个阶段给出一大批背景图片了。</p>
<h1 id="时间计算"><a href="#时间计算" class="headerlink" title="时间计算"></a>时间计算</h1><p>还记得上一篇文章吗，我们使用<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.324ex" height="1.581ex" role="img" focusable="false" viewBox="0 -677 1469 699"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>的时间作为一整轮的轮播动画时间。这也就意味着，算上淡入淡出，一张图片的整个周期也就是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="13.255ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 5858.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1000,0)"><g data-mml-node="mo"><path data-c="F7" d="M318 466Q318 500 339 518T386 537Q418 537 438 517T458 466Q458 438 440 417T388 396Q355 396 337 417T318 466ZM56 237T56 250T70 270H706Q721 262 721 250T706 230H70Q56 237 56 250ZM318 34Q318 68 339 86T386 105Q418 105 438 85T458 34Q458 6 440 -15T388 -36Q355 -36 337 -15T318 34Z"></path></g></g><g data-mml-node="mn" transform="translate(1778,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(2555.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(3611.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(4611.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(5000.6,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(5469.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></p>
<p>为了让第一张图片在这个周期之外更新，我们所需要做的，首先就是确定<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.324ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1469 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>的周期执行更新动作。</p>
<p>但是，光有这个<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.324ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1469 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>可不够。我们都知道，当浏览器加载过一次图片之后，下一次加载该图片将从缓存中直接读取，也就是我们寻常所说的<strong>命中缓存</strong>。</p>
<p>命中后，加载速度是相当迅猛的。我们不能赌他的枪里没有子弹。所以我们还需要额外设计一个定时器，要让这个<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.324ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1469 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>的周期稍微缓上一缓，才能够保证更新时间是处于我们所看不到的时间段内。</p>
<p>还记得上一篇文章的流程图吗：</p>
<pre class="mermaid">graph LR
    A[第一张图片]--25%--&gt;B[第二张图片]--25%--&gt;C[第三张图片]--25%--&gt;D[第四张图片]--25%--&gt;A</pre>

<p>我们主要是额外增加一个逻辑，让图片能够跟着时间有些修改：</p>
<pre class="mermaid">graph LR
    subgraph 轮播图
        A[第一张图片]--25%--&gt;B[第二张图片]--25%--&gt;C[第三张图片]--25%--&gt;D[第四张图片]--25%--&gt;A
    end
    subgraph 同步更新
        E[等待2s]--&gt;F[等待25%的动画结束]--&gt;G[更新图片]--&gt;E
    end
    subgraph 计数器
        H[[count = 0]] --&gt; I[count] --&gt; K[count mod 4]
        G --&gt; I
        K --&gt;|=0| A
        K --&gt;|=1| B
        K --&gt;|=2| C
        K --&gt;|=3| D
    end</pre>

<p>当然，除了<code>mod</code>计算，还有满<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.532ex" role="img" focusable="false" viewBox="0 -677 500 677"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g></svg></mjx-container>归零的方法，可以画成这样：</p>
<pre class="mermaid">graph LR
    subgraph 轮播图
        A[第一张图片]--25%--&gt;B[第二张图片]--25%--&gt;C[第三张图片]--25%--&gt;D[第四张图片]--25%--&gt;A
    end
    subgraph 同步更新
        E[等待2s]--&gt;F[等待25%的动画结束]--&gt;G[更新图片]--&gt;E
    end
    subgraph 计数器
        G--&gt;I{count = 4 ?}--yes--&gt;J[count - 4]--&gt;H--&gt;A
        O[[count = 0]] --&gt; I
        H[count = 0]
        L[count = 1] --&gt; B
        M[count = 2] --&gt; C
        N[count = 3] --&gt; D
        I--no--&gt;K[+1]--&gt;|+1| L &amp; M &amp; N
    end</pre>

<p>需要注意的是，在这里更新图片并不是与图片动画同步的。我这边设置的是当图片转过去之后再更改，也就是说，这里还有一个判断当前轮转索引与修改索引之间的关系。</p>
<pre class="mermaid">graph LR
    subgraph 轮播图
        A[第一张图片]--25%--&gt;B[第二张图片]--25%--&gt;C[第三张图片]--25%--&gt;D[第四张图片]--25%--&gt;A
    end
    subgraph 同步更新
        E[等待2s]--&gt;F[等待25%的动画结束]--&gt;G[更新图片]--&gt;E
    end
    subgraph 计数器
        I--(count+2)%4--&gt;P[index]--更新即触发--&gt;G
        I{count = 4 ?}--yes--&gt;J[count - 4]--&gt;H--&gt;A
        O[[count = 0]] --&gt; I
        H[count = 0]
        L[count = 1] --&gt; B
        M[count = 2] --&gt; C
        N[count = 3] --&gt; D
        I--no--&gt;K[+1]--&gt;|+1| L &amp; M &amp; N
    end</pre>

<h1 id="修改src属性还是直接将整个img标签替换掉"><a href="#修改src属性还是直接将整个img标签替换掉" class="headerlink" title="修改src属性还是直接将整个img标签替换掉"></a>修改src属性还是直接将整个img标签替换掉</h1><p>在这里，主要讨论的就是更新图片过程中，我们是修改<code>src</code>还是直接将整个<code>img</code>标签替换掉。</p>
<p>如果你有一定的经验，你会发现，如果<code>src</code>相同，则会直接命中缓存，不会更新图片。对于我们目前而言似乎确实可以使用，因为我们的背景图片并不会随意修改，而是始终保持链接。 当然，如果你有更多的经验，你会想到，在<code>GET</code>请求中加上一个时间戳，浏览器就会误以为这是一次新的请求，能够保证始终更新图片。</p>
<p>而如果是整个<code>img</code>直接替换掉，浏览器就会开始渲染流程，能够确保本次请求是一定能够被加载的。</p>
<p>当然，每种方法都有自己的优势跟弊端，这就需要各位自行判断了。接下来我将以替换整个<code>img</code>为例进行说明。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><p>好了，又到了<code>show me the code</code>环节。</p>
<h2 id="保存位置"><a href="#保存位置" class="headerlink" title="保存位置"></a>保存位置</h2><p>我们还是选择<code>source/js/utils.js</code>文件，在我们最开始增加的<code>addBackgroundImageDiv</code>方法的最下面继续增加：</p>
<h2 id="增加代码"><a href="#增加代码" class="headerlink" title="增加代码"></a>增加代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set background image url after rolling</span></span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>, index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> imgUrls = { <span class="string">'pc'</span>: [</span><br><span class="line">  <span class="string">'/race-miku.jpg'</span>, <span class="string">'/masuri-miku.jpg'</span>, <span class="string">'/planet-miku.jpg'</span>, <span class="string">'/4mikus.jpg'</span>, <span class="string">'/84672028_p0.jpg'</span>, <span class="string">'/84932457_p0.png'</span></span><br><span class="line">] }</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> === <span class="string">'complete'</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'done'</span>);</span><br><span class="line">    <span class="keyword">let</span> imgChangeInterval = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> imageChangeTimeOut = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'timeout'</span>);</span><br><span class="line">      <span class="keyword">if</span> (imgChangeInterval != <span class="literal">null</span>) {</span><br><span class="line">        <span class="built_in">clearInterval</span>(imgChangeInterval);</span><br><span class="line">        imgChangeInterval = <span class="literal">null</span>;</span><br><span class="line">      }</span><br><span class="line">      imgChangeInterval = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        index = (count + <span class="number">2</span>) % <span class="number">4</span></span><br><span class="line">        <span class="keyword">const</span> imageDivElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"image-scroller"</span>).<span class="property">children</span>[count % <span class="number">4</span>];</span><br><span class="line">        <span class="keyword">let</span> sampleImg = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * imgUrls[<span class="variable constant_">DEVICES</span>[<span class="number">0</span>]].<span class="property">length</span>);</span><br><span class="line">        imageDivElement.<span class="property">innerHTML</span> = <span class="string">"&lt;img"</span> +</span><br><span class="line">          <span class="string">" src='"</span> + <span class="variable constant_">BASE_URL</span> + <span class="variable constant_">DEVICES</span>[<span class="number">0</span>] + imgUrls[<span class="variable constant_">DEVICES</span>[<span class="number">0</span>]][sampleImg] + <span class="string">"'"</span> +</span><br><span class="line">          <span class="string">" style='width: 100%; height: 100%;'"</span> +</span><br><span class="line">          <span class="string">" alt='network broken?' /&gt;"</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`changed, now is <span class="subst">${count % <span class="number">4</span>}</span> and <span class="subst">${imgUrls[DEVICES[<span class="number">0</span>]][sampleImg]}</span>`</span>) <span class="comment">// yes</span></span><br><span class="line">        count = (count + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">      }, <span class="number">64000</span> / <span class="number">4</span>);</span><br><span class="line">      <span class="built_in">clearTimeout</span>(imageChangeTimeOut);</span><br><span class="line">    }, <span class="number">2000</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// well done! now images can be updated!</span></span><br></pre></td></tr></table></figure>

<p>这些代码能够按照约定更新图片，达到更多图片的轮播效果。虽然本文展示案例的时候只用了<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></svg></mjx-container>个图片（有<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.532ex" role="img" focusable="false" viewBox="0 -677 500 677"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g></svg></mjx-container>个是上一篇固定的），但是使用本文的代码就能够实现更多的图片了。</p>
<h2 id="没什么必要的其他东西"><a href="#没什么必要的其他东西" class="headerlink" title="没什么必要的其他东西"></a>没什么必要的其他东西</h2><p>同时，在代码中我也留下了三个节点的<code>console.log</code>方法，能够让各位能够感受到浏览器页面加载状态改变为<code>complete</code>的时候、<code>TimeOut</code>被触发的时候、<code>Interval</code>被触发的时候。</p>
<p>如果不出意外的话，<code>complete</code>输出将会很快出现，然后在<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex;" xmlns="http://www.w3.org/2000/svg" width="2.192ex" height="1.529ex" role="img" focusable="false" viewBox="0 -666 969 676"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>后出现<code>timeout</code>，接下来每<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.324ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1469 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container>产生<code>changed</code>输出。</p>
<h2 id="两篇文章的全部代码"><a href="#两篇文章的全部代码" class="headerlink" title="两篇文章的全部代码"></a>两篇文章的全部代码</h2><p>如果你是单纯复制本篇文章中的内容，可能并不能运行起来。因为诸如<code>DEVICES</code>、<code>BASE_URL</code>这类变量是上一篇文章中定义的变量。</p>
<p>所以，在这里，我将给出两篇文章的全部代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是官方的自启动函数</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onPageLoaded</span> = (<span class="params"></span>) =&gt; <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">'page:loaded'</span>, {</span><br><span class="line">      <span class="attr">bubbles</span>: <span class="literal">true</span></span><br><span class="line">    })</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> === <span class="string">'loading'</span>) {</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'readystatechange'</span>, onPageLoaded, { <span class="attr">once</span>: <span class="literal">true</span> });</span><br><span class="line">    <span class="title function_">addBackgroundImageDiv</span>(); <span class="comment">// 我在这里增加了自己的内容</span></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="title function_">onPageLoaded</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'pjax:success'</span>, onPageLoaded);</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后就是实现自己的内容</span></span><br><span class="line"><span class="comment">// add our custom dynamic background image</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addBackgroundImageDiv</span> () {</span><br><span class="line">  <span class="comment">// create dom element for background images</span></span><br><span class="line">  <span class="comment">// ----------------------------------------</span></span><br><span class="line">  <span class="keyword">const</span> opacityMask = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"div"</span>);</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">background</span> = <span class="string">"linear-gradient(#fff, #ffced9, #fff)"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">position</span> = <span class="string">"fixed"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">top</span> = <span class="string">"0"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">left</span> = <span class="string">"0"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">content</span> = <span class="string">""</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">width</span> = <span class="string">"100%"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">height</span> = <span class="string">"100%"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">"0.8"</span>;</span><br><span class="line">  opacityMask.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">"-2"</span>;</span><br><span class="line">  <span class="keyword">const</span> imageContainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"div"</span>);</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">position</span> = <span class="string">"fixed"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">top</span> = <span class="string">"0"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">left</span> = <span class="string">"0"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">content</span> = <span class="string">""</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">width</span> = <span class="string">"100%"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">height</span> = <span class="string">"100%"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">"-3"</span>;</span><br><span class="line">  <span class="keyword">const</span> imageScroller = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"div"</span>);</span><br><span class="line">  imageScroller.<span class="property">id</span> = <span class="string">"image-scroller"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">position</span> = <span class="string">"fixed"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">top</span> = <span class="string">"0"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">left</span> = <span class="string">"0"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">content</span> = <span class="string">""</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">width</span> = <span class="string">"400%"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">height</span> = <span class="string">"100%"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">display</span> = <span class="string">"flex"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">justifyContent</span> = <span class="string">"space-around"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">alignContent</span> = <span class="string">"center"</span>;</span><br><span class="line">  imageContainer.<span class="property">style</span>.<span class="property">alignItems</span> = <span class="string">"center"</span>;</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">"-4"</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(opacityMask);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(imageContainer);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(imageScroller);</span><br><span class="line">  <span class="comment">// well done! basic frames established!</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// url for background images</span></span><br><span class="line">  <span class="comment">// -------------------------</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">BASE_URL</span> = <span class="string">'http://images.sakebow.cn/bgimage/'</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">DEVICES</span> = [<span class="string">'pc'</span>]</span><br><span class="line">  <span class="keyword">const</span> imgWindowUrl = { <span class="string">'pc'</span>: [</span><br><span class="line">    <span class="string">'/race-miku.jpg'</span>, <span class="string">'/masuri-miku.jpg'</span>, <span class="string">'/planet-miku.jpg'</span>, <span class="string">'/4mikus.jpg'</span></span><br><span class="line">  ] };</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> imgUrlItem <span class="keyword">of</span> imgWindowUrl[<span class="string">'pc'</span>]) {</span><br><span class="line">    <span class="keyword">const</span> imageFrameItemContainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"div"</span>);</span><br><span class="line">    imageFrameItemContainer.<span class="property">style</span>.<span class="property">width</span> = imageContainer.<span class="property">style</span>.<span class="property">width</span>;</span><br><span class="line">    imageFrameItemContainer.<span class="property">style</span>.<span class="property">height</span> = <span class="string">"100%"</span>;</span><br><span class="line">    imageFrameItemContainer.<span class="property">innerHTML</span> = <span class="string">"&lt;img"</span> +</span><br><span class="line">      <span class="string">" src='"</span> + <span class="variable constant_">BASE_URL</span> + <span class="variable constant_">DEVICES</span>[<span class="number">0</span>] + imgUrlItem + <span class="string">"'"</span> +</span><br><span class="line">      <span class="string">" style='width: 100%; height: 100%;'"</span> +</span><br><span class="line">      <span class="string">" alt='network broken?' /&gt;"</span>;</span><br><span class="line">    imageScroller.<span class="title function_">appendChild</span>(imageFrameItemContainer);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// well done! all images ready!</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// keyframe to roll images</span></span><br><span class="line">  <span class="comment">// -------------------------------</span></span><br><span class="line">  <span class="comment">// create style element</span></span><br><span class="line">  <span class="keyword">const</span> imageRollStyle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'style'</span>);</span><br><span class="line">  <span class="comment">// set animation time for all</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">EPOCH_TIME</span> = <span class="number">64</span>;</span><br><span class="line">  <span class="comment">// set animation style for all</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">ANIMATION_DEFAULT_SETTINGS</span> = <span class="string">"s linear infinite running "</span>;</span><br><span class="line">  <span class="comment">// set keyframes into style element</span></span><br><span class="line">  imageRollStyle.<span class="property">innerHTML</span> = <span class="string">`@keyframes image-roll {</span></span><br><span class="line"><span class="string">    0%  { left: 0; } 24% { left: 0; } 25% { left: -100%; } 49% { left: -100%; } 50% { left: -200%; }</span></span><br><span class="line"><span class="string">    74% { left: -200%; } 75% { left: -300%; } 99% { left: -300%; } 100%{ left: 0; }</span></span><br><span class="line"><span class="string">  }@keyframes image-translate-child-1 {</span></span><br><span class="line"><span class="string">    0%  { scale: 1; opacity: 0 } 2% { scale: 1; opacity: 1; } 23% { scale: 1.1; } 25%, 100% { scale: 1.1; opacity: 0; }</span></span><br><span class="line"><span class="string">  }#image-scroller&gt;div:nth-child(1) {</span></span><br><span class="line"><span class="string">    animation: <span class="subst">${EPOCH_TIME + ANIMATION_DEFAULT_SETTINGS}</span> image-translate-child-1;</span></span><br><span class="line"><span class="string">  }@keyframes image-translate-child-2 {</span></span><br><span class="line"><span class="string">    0%, 25%  { scale: 1; opacity: 0 } 27% { scale: 1; opacity: 1; } 48% { scale: 1.1; } 50%, 100% { scale: 1.1; opacity: 0; }</span></span><br><span class="line"><span class="string">  }#image-scroller&gt;div:nth-child(2) {</span></span><br><span class="line"><span class="string">    animation: <span class="subst">${EPOCH_TIME + ANIMATION_DEFAULT_SETTINGS}</span> image-translate-child-2;</span></span><br><span class="line"><span class="string">  }@keyframes image-translate-child-3 {</span></span><br><span class="line"><span class="string">    0%, 50%  { scale: 1; opacity: 0 } 52% { scale: 1; opacity: 1; } 73% { scale: 1.1; } 75%, 100% { scale: 1.1; opacity: 0; }</span></span><br><span class="line"><span class="string">  }#image-scroller&gt;div:nth-child(3) {</span></span><br><span class="line"><span class="string">    animation: <span class="subst">${EPOCH_TIME + ANIMATION_DEFAULT_SETTINGS}</span> image-translate-child-3;</span></span><br><span class="line"><span class="string">  }@keyframes image-translate-child-4 {</span></span><br><span class="line"><span class="string">    0%, 75%  { scale: 1; opacity: 0 } 77% { scale: 1; opacity: 1; } 98% { scale: 1.1; } 100% { scale: 1.1; opacity: 0; }</span></span><br><span class="line"><span class="string">  }#image-scroller&gt;div:nth-child(4) {</span></span><br><span class="line"><span class="string">    animation: <span class="subst">${EPOCH_TIME + ANIMATION_DEFAULT_SETTINGS}</span> image-translate-child-4;</span></span><br><span class="line"><span class="string">  }`</span>;</span><br><span class="line">  <span class="comment">// well done! now images can be rolling with fadeIn and fadeOut style, as well as scale 1.1x slowly</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将style样式存放到head标签</span></span><br><span class="line">  <span class="comment">// ----------------------</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">'head'</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(imageRollStyle);</span><br><span class="line">  imageScroller.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">`<span class="subst">${EPOCH_TIME + ANIMATION_DEFAULT_SETTINGS}</span> image-roll`</span>;</span><br><span class="line">  <span class="comment">// well done! keyframes in effect!</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// set background image url after rolling</span></span><br><span class="line">  <span class="comment">// --------------------------------------</span></span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>, index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> imgUrls = { <span class="string">'pc'</span>: [</span><br><span class="line">    <span class="string">'/race-miku.jpg'</span>, <span class="string">'/masuri-miku.jpg'</span>, <span class="string">'/planet-miku.jpg'</span>, <span class="string">'/4mikus.jpg'</span>, <span class="string">'/84672028_p0.jpg'</span>, <span class="string">'/84932457_p0.png'</span></span><br><span class="line">  ] }</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> === <span class="string">'complete'</span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'done'</span>);</span><br><span class="line">      <span class="keyword">let</span> imgChangeInterval = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">let</span> imageChangeTimeOut = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'timeout'</span>);</span><br><span class="line">        <span class="keyword">if</span> (imgChangeInterval != <span class="literal">null</span>) {</span><br><span class="line">          <span class="built_in">clearInterval</span>(imgChangeInterval);</span><br><span class="line">          imgChangeInterval = <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line">        imgChangeInterval = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">          index = (count + <span class="number">2</span>) % <span class="number">4</span></span><br><span class="line">          <span class="keyword">const</span> imageDivElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"image-scroller"</span>).<span class="property">children</span>[count % <span class="number">4</span>];</span><br><span class="line">          <span class="keyword">let</span> sampleImg = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * imgUrls[<span class="variable constant_">DEVICES</span>[<span class="number">0</span>]].<span class="property">length</span>);</span><br><span class="line">          imageDivElement.<span class="property">innerHTML</span> = <span class="string">"&lt;img"</span> +</span><br><span class="line">            <span class="string">" src='"</span> + <span class="variable constant_">BASE_URL</span> + <span class="variable constant_">DEVICES</span>[<span class="number">0</span>] + imgUrls[<span class="variable constant_">DEVICES</span>[<span class="number">0</span>]][sampleImg] + <span class="string">"'"</span> +</span><br><span class="line">            <span class="string">" style='width: 100%; height: 100%;'"</span> +</span><br><span class="line">            <span class="string">" alt='network broken?' /&gt;"</span>;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`changed, now is <span class="subst">${count % <span class="number">4</span>}</span> and <span class="subst">${imgUrls[DEVICES[<span class="number">0</span>]][sampleImg]}</span>`</span>) <span class="comment">// yes</span></span><br><span class="line">          count = (count + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">        }, <span class="number">64000</span> / <span class="number">4</span>);</span><br><span class="line">        <span class="built_in">clearTimeout</span>(imageChangeTimeOut);</span><br><span class="line">      }, <span class="number">2000</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// well done! now images can be updated!</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>到这里，动态修改、动态显示的背景图片就实现了。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>sakebow
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://sakebow.cn/2023/12/26/custom/background-dynamic-more/" title="Hexo设置更多的动态背景图">http://sakebow.cn/2023/12/26/custom/background-dynamic-more/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/css/" rel="tag"># css</a>
              <a href="/tags/customize/" rel="tag"># customize</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/25/custom/background-dynamic/" rel="prev" title="Hexo设置少量固定的动态背景图">
                  <i class="fa fa-angle-left"></i> Hexo设置少量固定的动态背景图
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/12/26/custom/background-dynamic-import/" rel="next" title="通过引入js文件的方式使Hexo设置更多的动态背景图">
                  通过引入js文件的方式使Hexo设置更多的动态背景图 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鄂ICP备2020023162号-1 </a>
      <img src="http://images.sakebow.cn/icons/icp.png" alt="">
  </div>
  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">sakebow</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">19k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:08</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/sakebow" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/custom/add-background.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js","integrity":"sha256-mm3Re3y7xlvh+yCD+l/Zs1d+PU0AEad93MkWvljfm/s="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.3.0/wavedrom.min.js","integrity":"sha256-IRMDzTC+wK5stMucZ/XSXkeS5VNtxZ+/Bm8Mcqfoxdo="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.3.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>

  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
